<!doctype html><html lang=zh><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta><title>Apple Clangd 掉坑记 - 浮枕星海</title><link rel=manifest href=/manifest.json><meta name=theme-color content=#9932CC><meta name=application-name content=浮枕星海><meta name=msapplication-TileImage content=/img/favicon.png><meta name=msapplication-TileColor content=#9932CC><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-title content=浮枕星海><meta name=apple-mobile-web-app-status-bar-style content=default><meta name=description content="clangd 是 llvm 项目推出的 C&amp;#x2F;C++ 语言服务器，通过 LSP（Language Server Protocal）协议向编辑器如 vscode&amp;#x2F;vim&amp;#x2F;emacs 提供语法补全、错误检测、跳转、格式化等等功能。据说是比 vscode 自己的 IntelliSense 更好一些，我开始用 clangd 的时候 IntelliSense 貌似还不支持使用 compile_commands"><meta property=og:type content=blog><meta property=og:title content="Apple Clangd 掉坑记"><meta property=og:url content=https://universesaurora.top/2023/05/19/clangd-vsc-fault/ ><meta property=og:site_name content=浮枕星海><meta property=og:description content="clangd 是 llvm 项目推出的 C&amp;#x2F;C++ 语言服务器，通过 LSP（Language Server Protocal）协议向编辑器如 vscode&amp;#x2F;vim&amp;#x2F;emacs 提供语法补全、错误检测、跳转、格式化等等功能。据说是比 vscode 自己的 IntelliSense 更好一些，我开始用 clangd 的时候 IntelliSense 貌似还不支持使用 compile_commands"><meta property=og:locale content=zh_CN><meta property=og:image content=https://cdn.pixabay.com/photo/2023/05/15/15/33/landscape-7995369_1280.jpg><meta property=article:published_time content=2023-05-19T07:51:21.000Z><meta property=article:modified_time content=2023-05-19T12:33:45.000Z><meta property=article:author content=浮枕><meta property=article:tag content=vscode><meta property=article:tag content=clangd><meta property=article:tag content=llvm><meta property=twitter:card content=summary><meta property=twitter:image:src content=https://cdn.pixabay.com/photo/2023/05/15/15/33/landscape-7995369_1280.jpg><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://universesaurora.top/2023/05/19/clangd-vsc-fault/"},"headline":"Apple Clangd 掉坑记","image":["https://cdn.pixabay.com/photo/2023/05/15/15/33/landscape-7995369_1280.jpg"],"datePublished":"2023-05-19T07:51:21.000Z","dateModified":"2023-05-19T12:33:45.000Z","author":{"@type":"Person","name":"浮枕"},"publisher":{"@type":"Organization","name":"浮枕星海","logo":{"@type":"ImageObject","url":"https://universesaurora.top/img/logo.png"}},"description":"clangd 是 llvm 项目推出的 C&#x2F;C++ 语言服务器，通过 LSP（Language Server Protocal）协议向编辑器如 vscode&#x2F;vim&#x2F;emacs 提供语法补全、错误检测、跳转、格式化等等功能。据说是比 vscode 自己的 IntelliSense 更好一些，我开始用 clangd 的时候 IntelliSense 貌似还不支持使用 compile_commands"}</script><link rel=canonical href=https://universesaurora.top/2023/05/19/clangd-vsc-fault/ ><link rel=alternate href=/atom.xml title=浮枕星海 type=application/atom+xml><link rel=icon href=/img/favicon.png><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.4/css/all.min.css><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/highlight.js/11.7.0/styles/xcode.min.css><link rel=stylesheet href="https://fonts.googlefonts.cn/css2?family=Source+Serif+Pro&amp;family=Roboto+Mono&amp;family=Noto+Serif+SC"><link rel=stylesheet href=/css/default.css><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js defer></script><!--!--><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.css><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/lightgallery/1.10.0/css/lightgallery.min.css><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/justifiedGallery/3.8.1/css/justifiedGallery.min.css><script src="https://www.googletagmanager.com/gtag/js?id=UA-172917863-2" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-172917863-2")</script><!--!--><!--!--><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src=https://cdn.bootcdn.net/ajax/libs/pace/1.2.4/pace.min.js></script><!--!--><!--!--><meta name=follow.it-verification-code content=6w6wNNa9dLg34hkzxXZS><script>!function(){function e(){if(!location.hash)return;const e="#"+CSS.escape(location.hash.substring(1)),t=document.querySelector(`.tabs a[href="${e}"]`);if(!t)return;const n=t.parentElement.parentElement;Array.from(n.children).forEach((e=>e.classList.remove("is-active"))),Array.from(n.querySelectorAll("a")).map((e=>document.getElementById(e.getAttribute("href").substring(1)))).forEach((e=>e.classList.add("is-hidden"))),t&&t.parentElement.classList.add("is-active");const r=document.querySelector(e);r&&r.classList.remove("is-hidden")}e(),window.addEventListener("hashchange",e,!1)}()</script><meta name=generator content="Hexo 6.3.0"><body class=is-3-column><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href=/ ><img src=/img/logo.png alt=浮枕星海 height=28></a></div><div class=navbar-menu><div class=navbar-start><a class=navbar-item href=/ >首页</a><a class=navbar-item href=/archives>归档</a><a class=navbar-item href=/categories>分类</a><a class=navbar-item href=/tags>标签</a><a class=navbar-item href=/links>友链</a><a class=navbar-item href=/about>关于</a></div><div class=navbar-end><a class="navbar-item is-hidden-tablet catalogue" title=目录 href=javascript:;><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title=搜索 href=javascript:;><i class="fas fa-search"></i></a></div></div></div></nav><section class=section><div class=container><div class=columns><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class=card><div class=card-image><span class="image is-7by3"><img class=fill src=https://cdn.pixabay.com/photo/2023/05/15/15/33/landscape-7995369_1280.jpg alt="Apple Clangd 掉坑记"></span></div><article class="card-content article" role=article><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class=level-left><span class=level-item><time datetime=2023-05-19T07:51:21.000Z title="5/19/2023, 7:51:21 AM">2023-05-19</time>发表</span><span class=level-item><time datetime=2023-05-19T12:33:45.000Z title="5/19/2023, 12:33:45 PM">2023-05-19</time>更新</span><span class=level-item><a class=link-muted href=/categories/%E6%9D%82%E8%B0%88/ >杂谈</a></span><span class=level-item>12 分钟读完 (大约1726个字)</span><span class=level-item id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv>0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">Apple Clangd 掉坑记</h1><div class=content><p>clangd 是 llvm 项目推出的 C/C++ 语言服务器，通过 LSP（Language Server Protocal）协议向编辑器如 vscode/vim/emacs 提供语法补全、错误检测、跳转、格式化等等功能。据说是比 vscode 自己的 IntelliSense 更好一些，我开始用 clangd 的时候 IntelliSense 貌似还不支持使用 <code>compile_commands.js</code> 文件辅助代码分析，因此并没有具体对比过两者的差异。<p>macOS 上附带的 llvm 是 Apple 自己管理的，属于 Xcode 的一部分，这个版本其实是落后于主线版本很多的。理论上来说这种等待上游稳定后再选择使用的版本稳定性更好，问题会比较少，然而意外的这次在更新了 Xcode 后 clangd 就翻车了。</p><span id=more></span><p>我个人比较喜欢在 vscode 上配合 clangd 插件阅读内核代码（虽然在工作时只能用 vim + ctags 这种古朴的方式，不过 tag 文件确实更灵活些，尤其是需要看不同架构的代码实现时）。为了获得更精确的分析，一般我会在 make 时配合 bear 生成 <code>compile_commands.js</code> 文件，用于辅助 clangd 语法分析。这样几乎所有符号都能正确解析，对分析代码有很大的帮助。并且分析过程不需要编译，可以把 <code>compile_commands.js</code> 文件稍微修改一下，拿到其他安装了 llvm 的平台上也可以工作的很好。<p>前几天 Xcode 在后台自动更新了，今天打开 vscode 时顺手更新了下 vscode，重新启动后 clangd 提供的代码分析功能就完全坏掉了。<p>一开始 clangd 一直在报 <code>Error while reading shard xxx.c: wrong version: want 17, got 16</code> 这个错。我猜测可能是更新了 Xcode 后缓存的某些文件的版本和当前不符导致的，于是删除了项目目录下的 <code>.cache</code> <code>.tmp_*</code> 之类的文件，然后这个报错就消失了，但是 clangd 插件还是报告崩溃（我也很崩溃…<p>打开输出窗口看了下 clangd 插件的日志，报了一个 <code>Signalled during AST worker action: InlayHints</code> 错误，看起来是被某个信号中断了（其实当时通过这个大概能推测到是某个 bug 导致访问了非法内存地址）。这里 InlayHints 其实指的就是 vscode 中指针处在符号上方后会跳出来的悬浮嵌入提示，也就是 clangd 插件向 clangd server 请求提示信息时发生的错误。<p><img src=https://s2.loli.net/2024/04/03/coFzrZBxiG4RV5k.png alt=错误输出><p>Google 了下只找到了一个似乎比较符合目前情况的 <a target=_blank rel=noopener href=https://github.com/clangd/clangd/issues/1120>issue</a>，很巧的是他也是在用 clangd 分析内核代码时出现的（而且是访问了空指针导致的）。<p>不过我的输出中并没有栈回溯，不知道是不是 Apple 版的 clangd 去掉了栈回溯打印，因此还不能完全确定就是同一个问题。不过他提到了错误是 <code>EXPORT_SYMBOL</code> 宏展开后的代码导致的问题，因此我只留下两个没有 <code>EXPORT_SYMBOL</code> 宏的源文件，重启 vscode…<p><img src=https://s2.loli.net/2024/04/03/YN9UocWt63AH7xI.png alt="没有 EXPORT_SYMBOL，一切正常"><p>这次并没有崩溃，嵌入提示也在这个源文件中正常工作了。目前差不多能确定是同一个问题了，为了再次确认下，我想到既然他自己不打印，我可以挂 lldb 自己看啊～<p><img src=https://s2.loli.net/2024/04/03/Mkzj4SXOWvdmcDY.png alt="挂上 lldb"><p>只见我一个 attach，马上抓到了内存访问异常——<p><img src=https://s2.loli.net/2024/04/03/vWR2qg5NFxYAS64.png alt=异常栈回溯><p>直接贴一下内容：<figure class="highlight cpp"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br></pre><td class=code><pre><span class=line>(lldb) c</span><br><span class=line>Process <span class=number>27639</span> resuming</span><br><span class=line>Process <span class=number>27639</span> stopped</span><br><span class=line>* thread #<span class=number>15</span>, name = <span class=string>&#x27;ASTWorker:dev.c&#x27;</span>, stop reason = <span class=built_in>EXC_BAD_ACCESS</span> (code=<span class=number>1</span>, address=<span class=number>0x8</span>)</span><br><span class=line>    frame #<span class=number>0</span>: <span class=number>0x0000000109a31953</span> clangd`clang::RecursiveASTVisitor&lt;clang::clangd::(anonymous <span class=keyword>namespace</span>)::InlayHintVisitor&gt;::<span class=built_in>TraverseDecl</span>(clang::Decl*) + <span class=number>12051</span></span><br><span class=line>clangd`clang::RecursiveASTVisitor&lt;clang::clangd::(anonymous <span class=keyword>namespace</span>)::InlayHintVisitor&gt;::TraverseDecl:</span><br><span class=line>-&gt;  <span class=number>0x109a31953</span> &lt;+<span class=number>12051</span>&gt;: movl   <span class=number>0x8</span>(%rdx), %edx</span><br><span class=line>    <span class=number>0x109a31956</span> &lt;+<span class=number>12054</span>&gt;: movq   %r13, %rdi</span><br><span class=line>    <span class=number>0x109a31959</span> &lt;+<span class=number>12057</span>&gt;: movq   %r15, %rsi</span><br><span class=line>    <span class=number>0x109a3195c</span> &lt;+<span class=number>12060</span>&gt;: callq  <span class=number>0x109a4dcf0</span>               ; clang::clangd::(anonymous <span class=keyword>namespace</span>)::InlayHintVisitor::<span class=built_in>addReturnTypeHint</span>(clang::FunctionDecl*, clang::SourceLocation)</span><br><span class=line>Target <span class=number>0</span>: (clangd) stopped.</span><br><span class=line>(lldb) bt</span><br><span class=line>* thread #<span class=number>15</span>, name = <span class=string>&#x27;ASTWorker:dev.c&#x27;</span>, stop reason = <span class=built_in>EXC_BAD_ACCESS</span> (code=<span class=number>1</span>, address=<span class=number>0x8</span>)</span><br><span class=line>  * frame #<span class=number>0</span>: <span class=number>0x0000000109a31953</span> clangd`clang::RecursiveASTVisitor&lt;clang::clangd::(anonymous <span class=keyword>namespace</span>)::InlayHintVisitor&gt;::<span class=built_in>TraverseDecl</span>(clang::Decl*) + <span class=number>12051</span></span><br><span class=line>    frame #<span class=number>1</span>: <span class=number>0x0000000109a31cb8</span> clangd`clang::RecursiveASTVisitor&lt;clang::clangd::(anonymous <span class=keyword>namespace</span>)::InlayHintVisitor&gt;::<span class=built_in>TraverseDecl</span>(clang::Decl*) + <span class=number>12920</span></span><br><span class=line>    frame #<span class=number>2</span>: <span class=number>0x0000000109a2e680</span> clangd`clang::clangd::<span class=built_in>inlayHints</span>(clang::clangd::ParsedAST&amp;, llvm::Optional&lt;clang::clangd::Range&gt;) + <span class=number>336</span></span><br><span class=line>    frame #<span class=number>3</span>: <span class=number>0x0000000109949909</span> clangd`<span class=type>void</span> llvm::detail::UniqueFunctionBase&lt;<span class=type>void</span>, llvm::Expected&lt;clang::clangd::InputsAndAST&gt; &gt;::CallImpl&lt;clang::clangd::ClangdServer::<span class=built_in>inlayHints</span>(llvm::StringRef, llvm::Optional&lt;clang::clangd::Range&gt;, llvm::unique_function&lt;<span class=built_in>void</span> (llvm::Expected&lt;std::__1::vector&lt;clang::clangd::InlayHint, std::__1::allocator&lt;clang::clangd::InlayHint&gt; &gt; &gt;)&gt;)::$_21&gt;(<span class=type>void</span>*, llvm::Expected&lt;clang::clangd::InputsAndAST&gt;&amp;) + <span class=number>89</span></span><br><span class=line>    frame #<span class=number>4</span>: <span class=number>0x0000000109af3ae4</span> clangd`<span class=type>void</span> llvm::detail::UniqueFunctionBase&lt;<span class=type>void</span>&gt;::CallImpl&lt;clang::clangd::(anonymous <span class=keyword>namespace</span>)::ASTWorker::<span class=built_in>runWithAST</span>(llvm::StringRef, llvm::unique_function&lt;<span class=built_in>void</span> (llvm::Expected&lt;clang::clangd::InputsAndAST&gt;)&gt;, clang::clangd::TUScheduler::ASTActionInvalidation)::$_7&gt;(<span class=type>void</span>*) + <span class=number>1524</span></span><br><span class=line>    frame #<span class=number>5</span>: <span class=number>0x0000000109aeb56a</span> clangd`clang::clangd::(anonymous <span class=keyword>namespace</span>)::ASTWorker::<span class=built_in>runTask</span>(llvm::StringRef, llvm::function_ref&lt;<span class=built_in>void</span> ()&gt;) + <span class=number>522</span></span><br><span class=line>    frame #<span class=number>6</span>: <span class=number>0x0000000109ae953a</span> clangd`<span class=type>void</span> llvm::detail::UniqueFunctionBase&lt;<span class=type>void</span>&gt;::<span class=built_in>CallImpl</span>&lt;clang::clangd::(anonymous <span class=keyword>namespace</span>)::ASTWorker::<span class=built_in>create</span>(llvm::StringRef, clang::clangd::GlobalCompilationDatabase <span class=type>const</span>&amp;, clang::clangd::TUScheduler::ASTCache&amp;, clang::clangd::TUScheduler::HeaderIncluderCache&amp;, clang::clangd::AsyncTaskRunner*, clang::clangd::Semaphore&amp;, clang::clangd::TUScheduler::Options <span class=type>const</span>&amp;, clang::clangd::ParsingCallbacks&amp;)::$_4&gt;(<span class=type>void</span>*) + <span class=number>4250</span></span><br><span class=line>    frame #<span class=number>7</span>: <span class=number>0x0000000109c6ec37</span> clangd`<span class=type>void</span>* llvm::thread::ThreadProxy&lt;std::__1::tuple&lt;clang::clangd::AsyncTaskRunner::<span class=built_in>runAsync</span>(llvm::Twine <span class=type>const</span>&amp;, llvm::unique_function&lt;<span class=built_in>void</span> ()&gt;)::$_4&gt; &gt;(<span class=type>void</span>*) + <span class=number>71</span></span><br><span class=line>    frame #<span class=number>8</span>: <span class=number>0x00007ff811b31259</span> libsystem_pthread.dylib`_pthread_start + <span class=number>125</span></span><br><span class=line>    frame #<span class=number>9</span>: <span class=number>0x00007ff811b2cc7b</span> libsystem_pthread.dylib`thread_start + <span class=number>15</span></span><br></pre></table></figure><p>和这个 issue 的栈回溯基本完全一致，到此我们确认了问题。<p>不过我还有最后一个疑问，这个 issue 被提出来的时间距今已过去一年了。我确认了下 clangd 的版本，clangd 的版本号和 clang 是一致的，我系统中的版本目前是 14.0.3。目前 llvm 主线已经到 16.0.4 了，而主线的 14.0.3 是在2022年4月29日发布的。也就是说 Apple 的 llvm 落后于主线大概一年，而这个问题的修复 commit 刚好在 14.0.3 发布的一周后，也就是说并不包括在 14.0.3 中。不过话说这么久的必现崩溃问题不应该早就向后移植了吗，难道 Apple 的 llvm 团队在更新的时候只把编译器相关的问题向后移植了下，这个小小（？）的 clangd 问题就忽略了？<p><img src=https://s2.loli.net/2024/04/03/rkCaAnHJfF8Usx6.png alt="clangd 版本"><p><img src=https://s2.loli.net/2024/04/03/r7gdKfTjLyw4SD1.png alt="Xcode 版本"><p>又去<a target=_blank rel=noopener href=https://xcodereleases.com/alpha.html>这个网站</a>看了下 Xcode 版本对应的 Clang 版本，最新一次 Xcode 更新确实将 clang 从 14.0.0 更新到了 14.0.3，这一切也就说得通了。<p>最后我用 brew 安装了最新的 llvm 版本解决了这个问题。不过默认 brew 安装的版本并不会出现在 PATH 中（这点很好，毕竟 macOS 上 Xcode 之类主要用的还是这个版本，并且安装时也提示了混用版本可能出现问题），需要在 VScode 的 clangd 插件里指定了下使用 brew 安装的 <code>/usr/local/opt/llvm/bin/clangd</code> 路径上的 clangd。<p>终于，clangd 愉快的跑了起来，vscode 的嵌入提示也能正常显示了！<p><img src=https://s2.loli.net/2024/04/03/xQSbC6e32vO7YHB.png alt=恢复正常了！可喜可贺！><p>这个问题也让我想到了之前看到老雷发现的 Visual Studio 问题也是访问空指针（具体<a target=_blank rel=noopener href=https://mp.weixin.qq.com/s/ezPkE6ZUNr5lQFRGSwRI_A>在这</a>），即便是大公司发布的看起来可靠稳定的开发工具有时候还是会出 bug 的 ^ ^</div><div class="article-licensing box"><div class=licensing-title><p>Apple Clangd 掉坑记<p><a href=https://universesaurora.top/2023/05/19/clangd-vsc-fault/ >https://universesaurora.top/2023/05/19/clangd-vsc-fault/</a></div><div class="licensing-meta level is-mobile"><div class=level-left><div class="level-item is-narrow"><div><h6>作者</h6><p>浮枕</div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2023-05-19</div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2023-05-19</div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a rel=noopener target=_blank title="CC BY-NC-SA 4.0" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ >CC BY-NC-SA 4.0</a><a class=icons rel=noopener target=_blank title="Creative Commons" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ ><i class="icon fab fa-creative-commons"></i></a><a class=icons rel=noopener target=_blank title="CC BY" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ ><i class="icon fab fa-creative-commons-by"></i></a><a class=icons rel=noopener target=_blank title="CC NC" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ ><i class="icon fab fa-creative-commons-nc"></i></a><a class=icons rel=noopener target=_blank title="CC SA" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ ><i class="icon fab fa-creative-commons-sa"></i></a></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class=mr-2>#</span><a class="link-muted mr-2" rel=tag href=/tags/vscode/ >vscode</a><a class="link-muted mr-2" rel=tag href=/tags/clangd/ >clangd</a><a class="link-muted mr-2" rel=tag href=/tags/llvm/ >llvm</a></div><div class=sharethis-inline-share-buttons></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=6291b3ba6ad7c40019490138&amp;product=sop" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class=level-start><a class="article-nav-prev level level-item link-muted" href=/2024/05/18/initramfs_boot_fail/ ><i class="level-item fas fa-chevron-left"></i><span class=level-item>一次 Linux 5.4 内核启动失败分析</span></a></div><div class=level-end><a class="article-nav-next level level-item link-muted" href=/2023/04/21/skbuff-repost/ ><span class=level-item>Linux 内核网络中的 sk_buff 数据结构</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class=card><div class=card-content><h3 class="title is-5">评论</h3><div id=comment-container></div><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/gitalk/1.7.2/gitalk.css><script src=https://cdn.bootcdn.net/ajax/libs/gitalk/1.7.2/gitalk.min.js></script><script>var gitalk=new Gitalk({id:"bb95b41d72e8e5169c0a3207a1b3c5cf",repo:"universesaurora-blog",owner:"UniversesAurora",clientID:"0d93b8fa7142b6c21de0",clientSecret:"fd1449c0798a980110bd15b1a5e35ea3d590d9aa",admin:["UniversesAurora"],createIssueManually:!1,distractionFreeMode:!1,perPage:20,pagerDirection:"last",enableHotKey:!0,language:"zh-CN"});gitalk.render("comment-container")</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen order-1"><div class="card widget" data-type=profile><div class=card-content><nav class=level><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src=/img/avatar.png alt=浮枕></figure><p class="title is-size-4 is-block" style=line-height:inherit>浮枕<p class="is-size-6 is-block">Kernel panic at 0xffff467573696f6e<p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中央図書館断絶の壁分室</span></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class=heading>文章</p><a href=/archives><p class=title>7</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class=heading>分类</p><a href=/categories><p class=title>5</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class=heading>标签</p><a href=/tags><p class=title>14</p></a></div></div></nav><div class=level><a class="level-item button is-primary is-rounded" href=https://twitter.com/universesaurora target=_blank rel=noopener>关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target=_blank rel=noopener title=Telegram href=https://t.me/universesaurora><i class="fab fa-telegram"></i></a><a class="level-item button is-transparent is-marginless" target=_blank rel=noopener title=Mastodon href=https://mastodon.social/@universesaurora><i class="fab fa-mastodon"></i></a><a class="level-item button is-transparent is-marginless" target=_blank rel=noopener title=Twitter href=https://twitter.com/universesaurora><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target=_blank rel=noopener title=Github href=https://github.com/UniversesAurora><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target=_blank rel=noopener title=Email href=mailto:universesaurora@gmail.com><i class="fas fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target=_blank rel=noopener title=RSS href=/atom.xml><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" data-type=categories><div class=card-content><div class=menu><h3 class=menu-label>分类</h3><ul class=menu-list><li><a class="level is-mobile" href=/categories/%E5%86%85%E6%A0%B8/ ><span class=level-start><span class=level-item>内核</span></span><span class=level-end><span class="level-item tag">3</span></span></a><li><a class="level is-mobile" href=/categories/%E6%9D%82%E8%B0%88/ ><span class=level-start><span class=level-item>杂谈</span></span><span class=level-end><span class="level-item tag">1</span></span></a><li><a class="level is-mobile" href=/categories/%E7%A1%AC%E4%BB%B6/ ><span class=level-start><span class=level-item>硬件</span></span><span class=level-end><span class="level-item tag">1</span></span></a><li><a class="level is-mobile" href=/categories/%E9%80%86%E5%90%91/ ><span class=level-start><span class=level-item>逆向</span></span><span class=level-end><span class="level-item tag">1</span></span></a><li><a class="level is-mobile" href=/categories/%E9%9A%8F%E7%AC%94/ ><span class=level-start><span class=level-item>随笔</span></span><span class=level-end><span class="level-item tag">1</span></span></a></ul></div></div></div><div class="card widget" data-type=tags><div class=card-content><div class=menu><h3 class=menu-label>标签</h3><div class="field is-grouped is-grouped-multiline"><div class=control><a class="tags has-addons" href=/tags/Linux/ ><span class=tag>Linux</span><span class=tag>2</span></a></div><div class=control><a class="tags has-addons" href=/tags/clangd/ ><span class=tag>clangd</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/initramfs/ ><span class=tag>initramfs</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/llvm/ ><span class=tag>llvm</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/nvdimm/ ><span class=tag>nvdimm</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/sk-buff/ ><span class=tag>sk_buff</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/vscode/ ><span class=tag>vscode</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/%E5%86%85%E6%A0%B8/ ><span class=tag>内核</span><span class=tag>3</span></a></div><div class=control><a class="tags has-addons" href=/tags/%E6%B8%B8%E6%88%8F/ ><span class=tag>游戏</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/%E7%A1%AC%E4%BB%B6/ ><span class=tag>硬件</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/%E7%BD%91%E7%BB%9C/ ><span class=tag>网络</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/%E8%B0%83%E5%BA%A6%E5%99%A8/ ><span class=tag>调度器</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/%E9%80%86%E5%90%91/ ><span class=tag>逆向</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/%E9%9A%8F%E7%AC%94/ ><span class=tag>随笔</span><span class=tag>1</span></a></div></div></div></div></div><div class="card widget" data-type=archives><div class=card-content><div class=menu><h3 class=menu-label>归档</h3><ul class=menu-list><li><a class="level is-mobile" href=/archives/2024/05/ ><span class=level-start><span class=level-item>五月 2024</span></span><span class=level-end><span class="level-item tag">1</span></span></a><li><a class="level is-mobile" href=/archives/2023/05/ ><span class=level-start><span class=level-item>五月 2023</span></span><span class=level-end><span class="level-item tag">1</span></span></a><li><a class="level is-mobile" href=/archives/2023/04/ ><span class=level-start><span class=level-item>四月 2023</span></span><span class=level-end><span class="level-item tag">2</span></span></a><li><a class="level is-mobile" href=/archives/2022/07/ ><span class=level-start><span class=level-item>七月 2022</span></span><span class=level-end><span class="level-item tag">1</span></span></a><li><a class="level is-mobile" href=/archives/2022/06/ ><span class=level-start><span class=level-item>六月 2022</span></span><span class=level-end><span class="level-item tag">1</span></span></a><li><a class="level is-mobile" href=/archives/2022/05/ ><span class=level-start><span class=level-item>五月 2022</span></span><span class=level-end><span class="level-item tag">1</span></span></a></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><!--!--><div class="card widget" data-type=recent-posts><div class=card-content><h3 class=menu-label>最新文章</h3><article class=media><figure class=media-left><a class=image href=/2024/05/18/initramfs_boot_fail/ ><img src=https://cdn.pixabay.com/photo/2023/12/29/15/37/balloons-8476432_1280.jpg alt="一次 Linux 5.4 内核启动失败分析"></a></figure><div class=media-content><p class=date><time datetime=2024-05-18T15:25:38.000Z>2024-05-18</time><p class=title><a href=/2024/05/18/initramfs_boot_fail/ >一次 Linux 5.4 内核启动失败分析</a><p class=categories><a href=/categories/%E5%86%85%E6%A0%B8/ >内核</a></div></article><article class=media><figure class=media-left><a class=image href=/2023/05/19/clangd-vsc-fault/ ><img src=https://cdn.pixabay.com/photo/2023/05/15/15/33/landscape-7995369_1280.jpg alt="Apple Clangd 掉坑记"></a></figure><div class=media-content><p class=date><time datetime=2023-05-19T07:51:21.000Z>2023-05-19</time><p class=title><a href=/2023/05/19/clangd-vsc-fault/ >Apple Clangd 掉坑记</a><p class=categories><a href=/categories/%E6%9D%82%E8%B0%88/ >杂谈</a></div></article><article class=media><figure class=media-left><a class=image href=/2023/04/21/skbuff-repost/ ><img src=https://cdn.pixabay.com/photo/2018/10/19/12/14/train-3758523_1280.jpg alt="Linux 内核网络中的 sk_buff 数据结构"></a></figure><div class=media-content><p class=date><time datetime=2023-04-21T02:22:53.000Z>2023-04-21</time><p class=title><a href=/2023/04/21/skbuff-repost/ >Linux 内核网络中的 sk_buff 数据结构</a><p class=categories><a href=/categories/%E5%86%85%E6%A0%B8/ >内核</a></div></article><article class=media><figure class=media-left><a class=image href=/2023/04/20/cfs-weight-nice/ ><img src=https://cdn.pixabay.com/photo/2016/08/26/12/44/houses-1622066_1280.jpg alt=CFS调度器、权重、优先级与虚拟时钟></a></figure><div class=media-content><p class=date><time datetime=2023-04-20T13:47:32.000Z>2023-04-20</time><p class=title><a href=/2023/04/20/cfs-weight-nice/ >CFS调度器、权重、优先级与虚拟时钟</a><p class=categories><a href=/categories/%E5%86%85%E6%A0%B8/ >内核</a></div></article><article class=media><figure class=media-left><a class=image href=/2022/07/18/nvdimm-intro/ ><img src=https://s2.loli.net/2024/04/03/KAQofgkrGDpNdhz.png alt="nvdimm 技术与编程模型概览"></a></figure><div class=media-content><p class=date><time datetime=2022-07-18T08:45:16.000Z>2022-07-18</time><p class=title><a href=/2022/07/18/nvdimm-intro/ >nvdimm 技术与编程模型概览</a><p class=categories><a href=/categories/%E7%A1%AC%E4%BB%B6/ >硬件</a></div></article></div></div><div class="card widget" data-type=subscribe-email><div class=card-content><div class=menu><h3 class=menu-label>follow.it</h3><form action="https://api.follow.it/subscription-form/a1BGa2tQbURTbStQandqbGNOeWgzcytQME9iVityYVNVaVVGR2N5NzlGZDFaWDlHYnRLc0hmczZrVDFOY3dzamVYTDFIdGZxOVgvNTJwRm5RNjlqVVN5RzBNK0M1RVBUOEhlZXUwOEtyWG8vRVhPRUR4RFZFeUdwbTArSE0vdmF8dkswd0lGYUxxRGM0RHpnd280RDBtT3JXenNZQ2N6RG5oeVNjMjVTNitlcz0=/8" method=post target=_blank><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class=input name=email type=email placeholder=Email><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class=control><input class=button type=submit value=订阅></div></div></form></div></div></div><div class="card widget" data-type=links><div class=card-content><div class=menu><h3 class=menu-label>链接</h3><ul class=menu-list><li><a class="level is-mobile" href=https://MoeClue.com/ target=_blank rel=noopener><span class=level-left><span class=level-item>Moeka</span></span><span class=level-right><span class="level-item tag">moeclue.com</span></span></a><li><a class="level is-mobile" href=https://mou.best target=_blank rel=noopener><span class=level-left><span class=level-item>小莫のBase</span></span><span class=level-right><span class="level-item tag">mou.best</span></span></a></ul></div></div></div></div></div></div></section><footer class=footer><div class=container><div class=level><div class=level-start><a class="footer-logo is-block mb-2" href=/ ><img src=/img/logo.png alt=浮枕星海 height=28></a><p class=is-size-7><span>&copy; 2024 浮枕</span>  Powered by <a href=https://hexo.io/ target=_blank rel=noopener>Hexo</a> &amp; <a href=https://github.com/ppoffice/hexo-theme-icarus target=_blank rel=noopener>Icarus</a><br><span id=busuanzi_container_site_uv>共<span id=busuanzi_value_site_uv>0</span>个访客</span><p class=is-size-7>世界は、あなたのスキで目覚め、変わってゆくものなのですから...</div><div class=level-end><div class="field has-addons"><p class=control><a class="button is-transparent" target=_blank rel=noopener title="CC BY-NC-SA 4.0" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ >CC BY-NC-SA 4.0</a><p class=control><a class="button is-transparent is-large" target=_blank rel=noopener title="CC BY-NC-SA 4.0 icons" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ ><i class="fab fa-creative-commons"></i> <i class="fab fa-creative-commons-by"></i> <i class="fab fa-creative-commons-nc"></i> <i class="fab fa-creative-commons-sa"></i> </a></div></div></div></div></footer><script src=https://cdn.bootcdn.net/ajax/libs/jquery/3.3.1/jquery.min.js></script><script src=https://cdn.bootcdn.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js></script><script src=https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js defer></script><script>moment.locale("zh-cn")</script><script>var IcarusThemeSettings={article:{highlight:{clipboard:!0,fold:"unfolded"}}}</script><script src=/js/column.js></script><script src=/js/animation.js></script><a id=back-to-top title=回到顶端 href=javascript:;><i class="fas fa-chevron-up"></i></a><script src=/js/back_to_top.js defer></script><!--!--><!--!--><!--!--><!--!--><script src=https://cdn.bootcdn.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.js defer></script><script>window.addEventListener("load",(()=>{window.cookieconsent.initialise({type:"info",theme:"edgeless",static:!1,position:"bottom-right",content:{message:"此网站使用Cookie来改善您的体验。",dismiss:"知道了！",allow:"允许使用Cookie",deny:"拒绝",link:"了解更多",policy:"Cookie政策",href:"https://www.cookiesandyou.com/"},palette:{popup:{background:"#edeff5",text:"#838391"},button:{background:"#4b81e8"}}})}))</script><script src=https://cdn.bootcdn.net/ajax/libs/lightgallery/1.10.0/js/lightgallery.min.js defer></script><script src=https://cdn.bootcdn.net/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js defer></script><script>window.addEventListener("load",(()=>{"function"==typeof $.fn.lightGallery&&$(".article").lightGallery({selector:".gallery-item"}),"function"==typeof $.fn.justifiedGallery&&($(".justified-gallery > p > .gallery-item").length&&$(".justified-gallery > p > .gallery-item").unwrap(),$(".justified-gallery").justifiedGallery())}))</script><!--!--><!--!--><script id=MathJax-script async>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"},chtml:{matchFontHeight:!1}}</script><script src=https://cdn.bootcdn.net/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js></script><div id=outdated><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id=btnUpdateBrowser target=_blank rel=noopener href=http://outdatedbrowser.com/ >Update my browser now</a><p class=last><a href=# id=btnCloseUpdateBrowser title=Close>×</a></div><script src=https://cdn.bootcdn.net/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js defer></script><script>window.addEventListener("load",(function(){outdatedBrowser({bgColor:"#f25648",color:"#ffffff",lowerThan:"object-fit"})}))</script><!--!--><!--!--><!--!--><script src=/js/main.js defer></script><div class=searchbox><div class=searchbox-container><div class=searchbox-header><div class=searchbox-input-container><input class=searchbox-input placeholder=想要查找什么...></div><a class=searchbox-close href=javascript:;>×</a></div><div class=searchbox-body></div></div></div><script src=/js/insight.js defer></script><script>document.addEventListener("DOMContentLoaded",(function(){loadInsight({contentUrl:"/content.json"},{hint:"想要查找什么...",untitled:"(无标题)",posts:"文章",pages:"页面",categories:"分类",tags:"标签"})}))</script>
