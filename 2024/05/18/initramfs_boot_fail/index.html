<!doctype html><html lang=zh><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta><title>一次 Linux 5.4 内核启动失败分析 - 浮枕星海</title><link rel=manifest href=/manifest.json><meta name=theme-color content=#9932CC><meta name=application-name content=浮枕星海><meta name=msapplication-TileImage content=/img/favicon.png><meta name=msapplication-TileColor content=#9932CC><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-title content=浮枕星海><meta name=apple-mobile-web-app-status-bar-style content=default><meta name=description content="在我司一台 x86 服务器上遇到了一个奇怪的问题：这台服务器上一直以来使用的是从 linux-stable 主线的 lts 版本自行编译的内核，具体来说使用的是5.15.15版本内核。 由于驱动需要我尝试在上面编译和引导5.4.172内核，但无法正常启动，内核打印显示找不到任何分区。初步判断是硬盘控制器驱动没有加载，但是驱动已经以模块形式编译了（该服务器使用的是一个博通 RAID 控制器，对应驱动"><meta property=og:type content=blog><meta property=og:title content="一次 Linux 5.4 内核启动失败分析"><meta property=og:url content=https://universesaurora.top/2024/05/18/initramfs_boot_fail/ ><meta property=og:site_name content=浮枕星海><meta property=og:description content="在我司一台 x86 服务器上遇到了一个奇怪的问题：这台服务器上一直以来使用的是从 linux-stable 主线的 lts 版本自行编译的内核，具体来说使用的是5.15.15版本内核。 由于驱动需要我尝试在上面编译和引导5.4.172内核，但无法正常启动，内核打印显示找不到任何分区。初步判断是硬盘控制器驱动没有加载，但是驱动已经以模块形式编译了（该服务器使用的是一个博通 RAID 控制器，对应驱动"><meta property=og:locale content=zh_CN><meta property=og:image content=https://cdn.pixabay.com/photo/2023/12/29/15/37/balloons-8476432_1280.jpg><meta property=article:published_time content=2024-05-18T15:25:38.000Z><meta property=article:modified_time content=2024-05-24T15:40:31.000Z><meta property=article:author content=浮枕><meta property=article:tag content=内核><meta property=article:tag content=initramfs><meta property=twitter:card content=summary><meta property=twitter:image:src content=https://cdn.pixabay.com/photo/2023/12/29/15/37/balloons-8476432_1280.jpg><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://universesaurora.top/2024/05/18/initramfs_boot_fail/"},"headline":"一次 Linux 5.4 内核启动失败分析","image":["https://cdn.pixabay.com/photo/2023/12/29/15/37/balloons-8476432_1280.jpg"],"datePublished":"2024-05-18T15:25:38.000Z","dateModified":"2024-05-24T15:40:31.000Z","author":{"@type":"Person","name":"浮枕"},"publisher":{"@type":"Organization","name":"浮枕星海","logo":{"@type":"ImageObject","url":"https://universesaurora.top/img/logo.png"}},"description":"在我司一台 x86 服务器上遇到了一个奇怪的问题：这台服务器上一直以来使用的是从 linux-stable 主线的 lts 版本自行编译的内核，具体来说使用的是5.15.15版本内核。 由于驱动需要我尝试在上面编译和引导5.4.172内核，但无法正常启动，内核打印显示找不到任何分区。初步判断是硬盘控制器驱动没有加载，但是驱动已经以模块形式编译了（该服务器使用的是一个博通 RAID 控制器，对应驱动"}</script><link rel=canonical href=https://universesaurora.top/2024/05/18/initramfs_boot_fail/ ><link rel=alternate href=/atom.xml title=浮枕星海 type=application/atom+xml><link rel=icon href=/img/favicon.png><link rel=stylesheet href=https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-d/font-awesome/5.15.4/css/all.min.css><link rel=stylesheet href=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-d/highlight.js/11.7.0/styles/xcode.min.css><link rel=stylesheet href="https://google-fonts.mirrors.sjtug.sjtu.edu.cn/css2?family=Source+Serif+Pro&amp;family=Roboto+Mono&amp;family=Noto+Serif+SC"><link rel=stylesheet href=/css/default.css><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js defer></script><!--!--><link rel=stylesheet href=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-d/cookieconsent/3.1.1/cookieconsent.min.css><link rel=stylesheet href=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-d/lightgallery/1.10.0/css/lightgallery.min.css><link rel=stylesheet href=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-d/justifiedGallery/3.8.1/css/justifiedGallery.min.css><script src="https://www.googletagmanager.com/gtag/js?id=UA-172917863-2" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-172917863-2")</script><!--!--><!--!--><link rel=stylesheet href=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-d/outdated-browser/1.1.5/outdatedbrowser.min.css><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-d/pace/1.2.4/pace.min.js></script><!--!--><!--!--><meta name=follow.it-verification-code content=6w6wNNa9dLg34hkzxXZS><script>!function(){function e(){if(!location.hash)return;const e="#"+CSS.escape(location.hash.substring(1)),t=document.querySelector(`.tabs a[href="${e}"]`);if(!t)return;const n=t.parentElement.parentElement;Array.from(n.children).forEach((e=>e.classList.remove("is-active"))),Array.from(n.querySelectorAll("a")).map((e=>document.getElementById(e.getAttribute("href").substring(1)))).forEach((e=>e.classList.add("is-hidden"))),t&&t.parentElement.classList.add("is-active");const r=document.querySelector(e);r&&r.classList.remove("is-hidden")}e(),window.addEventListener("hashchange",e,!1)}()</script><meta name=generator content="Hexo 6.3.0"><body class=is-3-column><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href=/ ><img src=/img/logo.png alt=浮枕星海 height=28></a></div><div class=navbar-menu><div class=navbar-start><a class=navbar-item href=/ >首页</a><a class=navbar-item href=/archives>归档</a><a class=navbar-item href=/categories>分类</a><a class=navbar-item href=/tags>标签</a><a class=navbar-item href=/links>友链</a><a class=navbar-item href=/about>关于</a></div><div class=navbar-end><a class="navbar-item is-hidden-tablet catalogue" title=目录 href=javascript:;><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title=搜索 href=javascript:;><i class="fas fa-search"></i></a></div></div></div></nav><section class=section><div class=container><div class=columns><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class=card><div class=card-image><span class="image is-7by3"><img class=fill src=https://cdn.pixabay.com/photo/2023/12/29/15/37/balloons-8476432_1280.jpg alt="一次 Linux 5.4 内核启动失败分析"></span></div><article class="card-content article" role=article><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class=level-left><span class=level-item><time datetime=2024-05-18T15:25:38.000Z title="5/18/2024, 3:25:38 PM">2024-05-18</time>发表</span><span class=level-item><time datetime=2024-05-24T15:40:31.000Z title="5/24/2024, 3:40:31 PM">2024-05-24</time>更新</span><span class=level-item><a class=link-muted href=/categories/%E5%86%85%E6%A0%B8/ >内核</a></span><span class=level-item>16 分钟读完 (大约2465个字)</span><span class=level-item id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv>0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">一次 Linux 5.4 内核启动失败分析</h1><div class=content><p>在我司一台 x86 服务器上遇到了一个奇怪的问题：这台服务器上一直以来使用的是从 linux-stable 主线的 lts 版本自行编译的内核，具体来说使用的是5.15.15版本内核。<p>由于驱动需要我尝试在上面编译和引导5.4.172内核，但无法正常启动，内核打印显示找不到任何分区。初步判断是硬盘控制器驱动没有加载，但是驱动已经以模块形式编译了（该服务器使用的是一个博通 RAID 控制器，对应驱动为 megaraid_sas）。</p><span id=more></span><p>无奈我尝试将该驱动编译到内核，这次内核成功找到了所有分区，但却无法找到内核 cmdline 指定的 rootfs uuid：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br></pre><td class=code><pre><span class=line>VFS: Cannot open root device <span class=string>&quot;UUID=xxxxxxxxx&quot;</span> or unknown-block(0,0): error -6</span><br><span class=line>Please append a correct <span class=string>&quot;root=&quot;</span> boot option; here are the available partitions:</span><br><span class=line>0800 34441003008 sda</span><br><span class=line>driver: sd</span><br><span class=line>0801 14680000 sda1 afc0d02a-b8be-407c-8ac6-ob3ac86a26d</span><br><span class=line>0802 101376 sda2 eef76d84-e51a-49cb-b16b-a76fa7155b13</span><br><span class=line>0803 16384 sda3 df9f72aa-cb58-blab-bl48f56be269</span><br><span class=line>0804 22021166 sda4 c11f17f3-7ac6-l667-aaf0-a748cfbc193d</span><br><span class=line>0805 31236209184 sda5 yyyyyyyyyy</span><br><span class=line></span><br><span class=line>Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)</span><br><span class=line>CPU:31 PID:1 <span class=built_in>comm</span> swapper/0 Not tainted 5.4.172 <span class=comment>#14</span></span><br><span class=line>Hardware name: Dell Inc. PowerEdge R750/04V528, BIOS 1.7.4 06/27/2022</span><br></pre></table></figure><p>这里 rootfs 为 sda5，uuid <code>xxxxxxxxx</code> 通过检查 <code>blkid</code> 和 <code>lsblk -f</code> 输出可以确定是正确的。列表中 sda5 后的 uuid <code>yyyyyyyyyy</code> 与 <code>xxxxxxxxx</code> 并不相同，但在 <code>blkid</code> 输出中可以看到它是 sda5 的 <code>PARTUUID</code>：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line>% sudo blkid</span><br><span class=line>/dev/sda5: UUID=<span class=string>&quot;xxxxxxxxx&quot;</span> BLOCK_SIZE=<span class=string>&quot;4096&quot;</span> TYPE=<span class=string>&quot;ext4&quot;</span> PARTUUID=<span class=string>&quot;yyyyyyyyyy&quot;</span></span><br><span class=line>/dev/loop1: TYPE=<span class=string>&quot;squashfs&quot;</span></span><br><span class=line>/dev/loop19: TYPE=<span class=string>&quot;squashfs&quot;</span></span><br></pre></table></figure><h1 id=partuuid-%E4%B8%8E-uuid tabindex=-1>PARTUUID 与 UUID</h1><p>那么这里的 <code>PARTUUID</code> 是什么？<p>其实 <code>UUID</code> 指的是 <code>Filesystem UUID</code>，即文件系统 UUID；相对的 PARTUUID 指的就是 <code>Partition UUID</code>，即分区的 UUID。顾名思义 <code>Filesystem UUID</code> 是储存在文件系统中的，而 <code>Partition UUID</code> 是储存在分区表中的。<p>Linux 中的大多数文件系统都支持 Filesystem UUID，例如 ext2/3/4、XFS。但 FAT 和 NTFS 对 UUID 的支持可能没有那么好。<sup class=footnote-ref><a href=#fn1 id=fnref1>[1]</a></sup>如果没有一个可用的 initramfs 或者 initramfs 为空，内核就无法获取<code>UUID</code>（也不能获取 <code>LABEL</code>，即卷标）<sup class=footnote-ref><a href=#fn2 id=fnref2>[2]</a></sup>。<p>实际上，内核并不会处理 <code>UUID=</code> 这种标识符，而是会忽略该选项，由 initramfs 中的工具（如 udev）发现 <code>Filesystem UUID</code> 对应的设备并切换 rootfs。<figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br></pre><td class=code><pre><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * Convert a name into device number.  We accept the following variants:</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * 1) &lt;hex_major&gt;&lt;hex_minor&gt; device number in hexadecimal represents itself</span></span><br><span class=line><span class=comment> *         no leading 0x, for example b302.</span></span><br><span class=line><span class=comment> * 2) /dev/nfs represents Root_NFS (0xff)</span></span><br><span class=line><span class=comment> * 3) /dev/&lt;disk_name&gt; represents the device number of disk</span></span><br><span class=line><span class=comment> * 4) /dev/&lt;disk_name&gt;&lt;decimal&gt; represents the device number</span></span><br><span class=line><span class=comment> *         of partition - device number of disk plus the partition number</span></span><br><span class=line><span class=comment> * 5) /dev/&lt;disk_name&gt;p&lt;decimal&gt; - same as the above, that form is</span></span><br><span class=line><span class=comment> *    used when disk name of partitioned disk ends on a digit.</span></span><br><span class=line><span class=comment> * 6) PARTUUID=00112233-4455-6677-8899-AABBCCDDEEFF representing the</span></span><br><span class=line><span class=comment> *    unique id of a partition if the partition table provides it.</span></span><br><span class=line><span class=comment> *    The UUID may be either an EFI/GPT UUID, or refer to an MSDOS</span></span><br><span class=line><span class=comment> *    partition using the format SSSSSSSS-PP, where SSSSSSSS is a zero-</span></span><br><span class=line><span class=comment> *    filled hex representation of the 32-bit &quot;NT disk signature&quot;, and PP</span></span><br><span class=line><span class=comment> *    is a zero-filled hex representation of the 1-based partition number.</span></span><br><span class=line><span class=comment> * 7) PARTUUID=&lt;UUID&gt;/PARTNROFF=&lt;int&gt; to select a partition in relation to</span></span><br><span class=line><span class=comment> *    a partition with a known unique id.</span></span><br><span class=line><span class=comment> * 8) &lt;major&gt;:&lt;minor&gt; major and minor number of the device separated by</span></span><br><span class=line><span class=comment> *    a colon.</span></span><br><span class=line><span class=comment> * 9) PARTLABEL=&lt;name&gt; with name being the GPT partition label.</span></span><br><span class=line><span class=comment> *    MSDOS partitions do not support labels!</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * If name doesn&#x27;t have fall into the categories above, we return (0,0).</span></span><br><span class=line><span class=comment> * block_class is used to check if something is a disk name. If the disk</span></span><br><span class=line><span class=comment> * name contains slashes, the device name has them replaced with</span></span><br><span class=line><span class=comment> * bangs.</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line></span><br><span class=line><span class=type>dev_t</span> <span class="title function_">name_to_dev_t</span><span class=params>(<span class=type>const</span> <span class=type>char</span> *name)</span></span><br></pre></table></figure><p>上面内核源码中的注释说明了内核能够处理的几种设备标识符，其中并没有 <code>UUID</code>，大概看了下应该是在 <code>md_setup_drive</code> 中调用 <code>name_to_dev_t</code> 来解析标识符。<p>也可以尝试把 <code>UUID</code> 更改为一个不存在的值，最终控制台将输出如下内容：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br></pre><td class=code><pre><span class=line>Begin: Loading essential drivers ... <span class=keyword>done</span>.</span><br><span class=line>Begin: Running /scripts/init-premount ... <span class=keyword>done</span>.</span><br><span class=line>Begin: Mounting root file system ... Begin: Running /scripts/local-top ... <span class=keyword>done</span>.</span><br><span class=line>Begin: Running /scripts/local-premount ... <span class=keyword>done</span>.</span><br><span class=line>Begin: Waiting <span class=keyword>for</span> root file system ... Begin: Running /scripts/local-block ... <span class=keyword>done</span>.</span><br><span class=line><span class=keyword>done</span>.</span><br><span class=line>Gave up waiting <span class=keyword>for</span> root file system device.  Common problems:</span><br><span class=line> - Boot args (<span class=built_in>cat</span> /proc/cmdline)</span><br><span class=line>   - Check rootdelay= (did the system <span class=built_in>wait</span> long enough?)</span><br><span class=line> - Missing modules (<span class=built_in>cat</span> /proc/modules; <span class=built_in>ls</span> /dev)</span><br><span class=line>ALERT!  UUID=50303285-93e1-49a2-92a0-24868766cff1 does not exist.  Dropping to a shell!</span><br><span class=line></span><br><span class=line></span><br><span class=line>BusyBox v1.30.1 (Ubuntu 1:1.30.1-7ubuntu3) built-in shell (ash)</span><br><span class=line>Enter <span class=string>&#x27;help&#x27;</span> <span class=keyword>for</span> a list of built-in commands.</span><br><span class=line></span><br><span class=line>(initramfs)</span><br></pre></table></figure><p>很明显，这些输出内容是由 initramfs 中的程序或脚本输出的，内核本身并未输出错误信息。这也说明了 <code>UUID=</code> 标识符并非由内核处理。<p>内核中如果包含了所有所需的文件系统驱动，那么应该能够自行获得所有文件系统的 UUID，似乎并没有通过用户程序的必要。我也没有在网上发现这一做法的必要性的说法，因此推断该策略的目的可能是实现一定程度的解耦，毕竟正常情况下服务器系统都会加载 initramfs，而更精简的嵌入式领域则少有储存硬件变动的需求。通过用户程序控制该过程也能获得更多的灵活性。<p>这样看来，结合之前遇到的驱动问题，可以判断由于某些原因 initramfs 没有被正常加载，或者 initramfs 内容有误。<h1 id=%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-a%EF%BC%9A%E8%AE%A9-grub-%E4%BD%BF%E7%94%A8-partuuid-%E6%88%96%E8%B7%AF%E5%BE%84 tabindex=-1>解决方案 A：让 grub 使用 PARTUUID 或路径</h1><p>这里需要说明的是，使用 UUID 作为作为 rootfs 标识符是 grub 的默认行为。每当要从源码安装新内核时，一般做法是执行 <code>make install</code>，这背后执行了内核安装、DKMS模块编译、initramfs/initrd 生成、grub.cfg 生成等一系列操作。为了控制生成 grub.cfg 的默认行为，需要修改 /etc/default/grub 配置文件。<p>这里为了让 grub 在生成 grub.cfg 时使用路径（即 /dev/sdXX），可以在 /etc/default/grub 中添加：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>GRUB_DISABLE_LINUX_UUID=<span class=literal>true</span></span><br></pre></table></figure><p>但如果服务器的硬盘连接顺序发生变化（或者其他可能改变硬件拓扑的情况），rootfs 在系统中的路径就可能发生变化（如从 /dev/sda5 变为 /dev/sdb5），导致系统无法启动。这也是 grub 默认使用 UUID 的原因。<p>因此我们可以选择使用 <code>PARTUUID</code>，从 grub 2.04 版本<sup class=footnote-ref><a href=#fn3 id=fnref3>[3]</a></sup>开始，支持了一个新的选项 <code>GRUB_DISABLE_LINUX_PARTUUID</code>，通过与 <code>GRUB_DISABLE_LINUX_UUID</code> 结合可以让 grub 使用 <code>PARTUUID</code> 作为标识符<sup class=footnote-ref><a href=#fn4 id=fnref4>[4]</a></sup>：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>GRUB_DISABLE_LINUX_UUID=<span class=literal>true</span></span><br><span class=line>GRUB_DISABLE_LINUX_PARTUUID=<span class=literal>false</span></span><br></pre></table></figure><p>另外要注意的是，只有 GPT 分区表才有标准的 UUID。MBR 来说并没有一个真正的 UUID，它的 PARTUUID 要短得多，因为它实际上是 PTUUID + 分区编号。因为它们不够长，无法确保唯一性，并且无法保证分区一定存在 PARTUUID。具体解释参见：<a target=_blank rel=noopener href=https://unix.stackexchange.com/questions/751946/are-uuids-and-ptuuids-important-for-mbr-disks-if-so-how-do-i-create-them-on-my>partition - Are UUIDs and PTUUIDs important for MBR disks? If so, how do I create them on my own? - Unix &amp; Linux Stack Exchange</a><h1 id=%E5%88%86%E6%9E%90-initramfs-%E5%8A%A0%E8%BD%BD tabindex=-1>分析 initramfs 加载</h1><p>解决方案 A 只是治标不治本，initramfs 被正常加载才是我们最终的目标。<p>对比了 5.4.172 和 5.15.15 内核打印的区别，在 5.15.15 中找到两条关键打印：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line> RAMDISK: [mem 0x3900b000-0x3fffdfff]</span><br><span class=line>...</span><br><span class=line> Trying to unpack rootfs image as initramfs...</span><br></pre></table></figure><p>在内核中搜索了下，第一个打印来自于 <code>reserve_initrd</code>：<figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br></pre><td class=code><pre><span class=line><span class=type>static</span> <span class=type>void</span> __init <span class="title function_">reserve_initrd</span><span class=params>(<span class=type>void</span>)</span></span><br><span class=line>&#123;</span><br><span class=line> <span class=comment>/* Assume only end is not page aligned */</span></span><br><span class=line> u64 ramdisk_image = get_ramdisk_image();</span><br><span class=line> u64 ramdisk_size  = get_ramdisk_size();</span><br><span class=line> u64 ramdisk_end   = PAGE_ALIGN(ramdisk_image + ramdisk_size);</span><br><span class=line> u64 mapped_size;</span><br><span class=line></span><br><span class=line> <span class=keyword>if</span> (!boot_params.hdr.type_of_loader ||</span><br><span class=line>     !ramdisk_image || !ramdisk_size)</span><br><span class=line>  <span class=keyword>return</span>;  <span class=comment>/* No initrd provided by bootloader */</span></span><br><span class=line></span><br><span class=line> initrd_start = <span class=number>0</span>;</span><br><span class=line></span><br><span class=line> mapped_size = memblock_mem_size(max_pfn_mapped);</span><br><span class=line> <span class=keyword>if</span> (ramdisk_size &gt;= (mapped_size&gt;&gt;<span class=number>1</span>))</span><br><span class=line>  panic(<span class=string>&quot;initrd too large to handle, &quot;</span></span><br><span class=line>         <span class=string>&quot;disabling initrd (%lld needed, %lld available)\n&quot;</span>,</span><br><span class=line>         ramdisk_size, mapped_size&gt;&gt;<span class=number>1</span>);</span><br><span class=line></span><br><span class=line> printk(KERN_INFO <span class=string>&quot;RAMDISK: [mem %#010llx-%#010llx]\n&quot;</span>, ramdisk_image,</span><br><span class=line>   ramdisk_end - <span class=number>1</span>);</span><br></pre></table></figure><p>准备在内核中加入一些打印调试下，结果发现这次生成的内核出现了 unpack initrd 的打印，但仍然无法使用 UUID 启动。<p>尝试在自己的 Ubuntu 22.04 LTS 虚拟机（并且软件包均更新到最新版本）上也安装了5.4.172内核，意外发现与服务器上的现象一致。通过串口将错误现场的内核打印输出到文件中，发现以下打印：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>[    1.839668] Unpacking initramfs...</span><br><span class=line>[    1.843910] Initramfs unpacking failed: invalid magic at start of compressed archive</span><br></pre></table></figure><p>出现了明确的错误，这就很好解决了。在网上查了下该错误，是因为目前较新的发行版都使用 zstd 作为 initramfs 压缩算法，而该算法在 5.10 内核中才得到支持。<sup class=footnote-ref><a href=#fn5 id=fnref5>[5]</a></sup><h1 id=%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-b%EF%BC%9A%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8-gzip-%E5%8E%8B%E7%BC%A9-initramfs tabindex=-1>解决方案 B：配置使用 gzip 压缩 initramfs</h1><p>对于 Ubuntu 来说，可以修改 <code>/etc/initramfs-tools/initramfs.conf</code> 文件，将 <code>COMPRESS=zstd</code> 修改为 <code>COMPRESS=gzip</code><sup class=footnote-ref><a href=#fn6 id=fnref6>[6]</a></sup>。再次执行 <code>sudo make install</code> 或者 <code>sudo update-initramfs -c -k 5.4.172</code> 即可。<p>在服务器上修改了下，可以使用 UUID 标识 rootfs 了。但服务器之前并没有 unpack 出错的打印，打印内容也不太一样，根据代码来看是启用了 <code>CONFIG_BLK_DEV_RAM</code> 的原因：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=keyword>if</span> (IS_ENABLED(CONFIG_BLK_DEV_RAM))</span><br><span class=line> printk(KERN_INFO <span class=string>&quot;Trying to unpack rootfs image as initramfs...\n&quot;</span>);</span><br><span class=line><span class=keyword>else</span></span><br><span class=line> printk(KERN_INFO <span class=string>&quot;Unpacking initramfs...\n&quot;</span>);</span><br></pre></table></figure><p>这个选项是给 initrd 使用的<sup class=footnote-ref><a href=#fn7 id=fnref7>[7]</a></sup>，由于这里仅判断了该选项是否开启，所以和实际加载的是 initrd 还是 initramfs 并没有关系，这里我们使用的是 initramfs。<hr class=footnotes-sep><section class=footnotes><ol class=footnotes-list><li id=fn1 class=footnote-item><p><a target=_blank rel=noopener href=https://www.linux.com/news/what-uuids-can-do-you/ >What UUIDs can do for you - Linux.com</a> <a href=#fnref1 class=footnote-backref>↩︎</a><li id=fn2 class=footnote-item><p><a target=_blank rel=noopener href=https://unix.stackexchange.com/questions/93767/why-cant-i-specify-my-root-fs-with-a-uuid#comment142167_93767>linux - Why can’t I specify my root fs with a UUID? - Unix &amp; Linux Stack Exchange</a> <a href=#fnref2 class=footnote-backref>↩︎</a><li id=fn3 class=footnote-item><p><a target=_blank rel=noopener href=https://wiki.gentoo.org/wiki/GRUB/Configuration_variables>GRUB/Configuration variables - Gentoo Wiki</a> <a href=#fnref3 class=footnote-backref>↩︎</a><li id=fn4 class=footnote-item><p><a target=_blank rel=noopener href=https://forums.gentoo.org/viewtopic-t-1049514-start-0.html>Gentoo Forums - How to make GRUB pass PARTUUID to the kernel</a> <a href=#fnref4 class=footnote-backref>↩︎</a><li id=fn5 class=footnote-item><p><a target=_blank rel=noopener href=https://forum.manjaro.org/t/initramfs-unpacking-failed-invalid-magic-as-start-of-compressed/137451/3>Initramfs unpacking failed: invalid magic as start of compressed - Support - Manjaro Linux Forum</a> <a href=#fnref5 class=footnote-backref>↩︎</a><li id=fn6 class=footnote-item><p><a target=_blank rel=noopener href=https://askubuntu.com/questions/1277532/having-trouble-with-initramfs-unpacking-failed-decoding-failed-solutions>boot - Having trouble with “Initramfs unpacking failed: Decoding failed” solutions - Ask Ubuntu</a> <a href=#fnref6 class=footnote-backref>↩︎</a><li id=fn7 class=footnote-item><p><a target=_blank rel=noopener href=https://cateee.net/lkddb/web-lkddb/BLK_DEV_RAM.html>Linux Kernel Driver DataBase: CONFIG_BLK_DEV_RAM: RAM block device support</a> <a href=#fnref7 class=footnote-backref>↩︎</a></ol></section></div><div class="article-licensing box"><div class=licensing-title><p>一次 Linux 5.4 内核启动失败分析<p><a href=https://universesaurora.top/2024/05/18/initramfs_boot_fail/ >https://universesaurora.top/2024/05/18/initramfs_boot_fail/</a></div><div class="licensing-meta level is-mobile"><div class=level-left><div class="level-item is-narrow"><div><h6>作者</h6><p>浮枕</div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2024-05-18</div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2024-05-24</div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a rel=noopener target=_blank title="CC BY-NC-SA 4.0" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ >CC BY-NC-SA 4.0</a><a class=icons rel=noopener target=_blank title="Creative Commons" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ ><i class="icon fab fa-creative-commons"></i></a><a class=icons rel=noopener target=_blank title="CC BY" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ ><i class="icon fab fa-creative-commons-by"></i></a><a class=icons rel=noopener target=_blank title="CC NC" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ ><i class="icon fab fa-creative-commons-nc"></i></a><a class=icons rel=noopener target=_blank title="CC SA" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ ><i class="icon fab fa-creative-commons-sa"></i></a></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class=mr-2>#</span><a class="link-muted mr-2" rel=tag href=/tags/%E5%86%85%E6%A0%B8/ >内核</a><a class="link-muted mr-2" rel=tag href=/tags/initramfs/ >initramfs</a></div><div class=sharethis-inline-share-buttons></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=6291b3ba6ad7c40019490138&amp;product=sop" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class=level-start><a class="article-nav-prev level level-item link-muted" href=/2024/09/29/bonjour_fix/ ><i class="level-item fas fa-chevron-left"></i><span class=level-item>Bonjour 不 Bon：修复 Bonjour 中存在的 IPv6 栈溢出 bug</span></a></div><div class=level-end><a class="article-nav-next level level-item link-muted" href=/2023/05/19/clangd_vsc_fault/ ><span class=level-item>Apple Clangd 掉坑记</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class=card><div class=card-content><h3 class="title is-5">评论</h3><div id=comment-container></div><link rel=stylesheet href=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-d/gitalk/1.7.2/gitalk.css><script src=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-d/gitalk/1.7.2/gitalk.min.js></script><script>var gitalk=new Gitalk({id:"41e3610463b1b02bc7576a5d169e025e",repo:"universesaurora-blog",owner:"UniversesAurora",clientID:"0d93b8fa7142b6c21de0",clientSecret:"fd1449c0798a980110bd15b1a5e35ea3d590d9aa",admin:["UniversesAurora"],createIssueManually:!1,distractionFreeMode:!1,perPage:20,pagerDirection:"last",enableHotKey:!0,language:"zh-CN"});gitalk.render("comment-container")</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen order-1"><div class="card widget" data-type=profile><div class=card-content><nav class=level><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src=/img/avatar.png alt=浮枕></figure><p class="title is-size-4 is-block" style=line-height:inherit>浮枕<p class="is-size-6 is-block">Kernel panic at 0xffff467573696f6e<p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中央図書館断絶の壁分室</span></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class=heading>文章</p><a href=/archives><p class=title>8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class=heading>分类</p><a href=/categories><p class=title>5</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class=heading>标签</p><a href=/tags><p class=title>16</p></a></div></div></nav><div class=level><a class="level-item button is-primary is-rounded" href=https://twitter.com/universesaurora target=_blank rel=noopener>关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target=_blank rel=noopener title=Telegram href=https://t.me/universesaurora><i class="fab fa-telegram"></i></a><a class="level-item button is-transparent is-marginless" target=_blank rel=noopener title=Mastodon href=https://mastodon.social/@universesaurora><i class="fab fa-mastodon"></i></a><a class="level-item button is-transparent is-marginless" target=_blank rel=noopener title=Twitter href=https://twitter.com/universesaurora><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target=_blank rel=noopener title=Github href=https://github.com/UniversesAurora><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target=_blank rel=noopener title=Email href=mailto:universesaurora@gmail.com><i class="fas fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target=_blank rel=noopener title=RSS href=/atom.xml><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" data-type=categories><div class=card-content><div class=menu><h3 class=menu-label>分类</h3><ul class=menu-list><li><a class="level is-mobile" href=/categories/%E5%86%85%E6%A0%B8/ ><span class=level-start><span class=level-item>内核</span></span><span class=level-end><span class="level-item tag">3</span></span></a><li><a class="level is-mobile" href=/categories/%E6%9D%82%E8%B0%88/ ><span class=level-start><span class=level-item>杂谈</span></span><span class=level-end><span class="level-item tag">1</span></span></a><li><a class="level is-mobile" href=/categories/%E7%A1%AC%E4%BB%B6/ ><span class=level-start><span class=level-item>硬件</span></span><span class=level-end><span class="level-item tag">1</span></span></a><li><a class="level is-mobile" href=/categories/%E9%80%86%E5%90%91/ ><span class=level-start><span class=level-item>逆向</span></span><span class=level-end><span class="level-item tag">2</span></span></a><li><a class="level is-mobile" href=/categories/%E9%9A%8F%E7%AC%94/ ><span class=level-start><span class=level-item>随笔</span></span><span class=level-end><span class="level-item tag">1</span></span></a></ul></div></div></div><div class="card widget" data-type=tags><div class=card-content><div class=menu><h3 class=menu-label>标签</h3><div class="field is-grouped is-grouped-multiline"><div class=control><a class="tags has-addons" href=/tags/Bonjour/ ><span class=tag>Bonjour</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/Linux/ ><span class=tag>Linux</span><span class=tag>2</span></a></div><div class=control><a class="tags has-addons" href=/tags/clangd/ ><span class=tag>clangd</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/initramfs/ ><span class=tag>initramfs</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/llvm/ ><span class=tag>llvm</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/nvdimm/ ><span class=tag>nvdimm</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/sk-buff/ ><span class=tag>sk_buff</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/vscode/ ><span class=tag>vscode</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/%E4%BB%A3%E7%90%86/ ><span class=tag>代理</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/%E5%86%85%E6%A0%B8/ ><span class=tag>内核</span><span class=tag>3</span></a></div><div class=control><a class="tags has-addons" href=/tags/%E6%B8%B8%E6%88%8F/ ><span class=tag>游戏</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/%E7%A1%AC%E4%BB%B6/ ><span class=tag>硬件</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/%E7%BD%91%E7%BB%9C/ ><span class=tag>网络</span><span class=tag>2</span></a></div><div class=control><a class="tags has-addons" href=/tags/%E8%B0%83%E5%BA%A6%E5%99%A8/ ><span class=tag>调度器</span><span class=tag>1</span></a></div><div class=control><a class="tags has-addons" href=/tags/%E9%80%86%E5%90%91/ ><span class=tag>逆向</span><span class=tag>2</span></a></div><div class=control><a class="tags has-addons" href=/tags/%E9%9A%8F%E7%AC%94/ ><span class=tag>随笔</span><span class=tag>1</span></a></div></div></div></div></div><div class="card widget" data-type=archives><div class=card-content><div class=menu><h3 class=menu-label>归档</h3><ul class=menu-list><li><a class="level is-mobile" href=/archives/2024/09/ ><span class=level-start><span class=level-item>九月 2024</span></span><span class=level-end><span class="level-item tag">1</span></span></a><li><a class="level is-mobile" href=/archives/2024/05/ ><span class=level-start><span class=level-item>五月 2024</span></span><span class=level-end><span class="level-item tag">1</span></span></a><li><a class="level is-mobile" href=/archives/2023/05/ ><span class=level-start><span class=level-item>五月 2023</span></span><span class=level-end><span class="level-item tag">1</span></span></a><li><a class="level is-mobile" href=/archives/2023/04/ ><span class=level-start><span class=level-item>四月 2023</span></span><span class=level-end><span class="level-item tag">2</span></span></a><li><a class="level is-mobile" href=/archives/2022/07/ ><span class=level-start><span class=level-item>七月 2022</span></span><span class=level-end><span class="level-item tag">1</span></span></a><li><a class="level is-mobile" href=/archives/2022/06/ ><span class=level-start><span class=level-item>六月 2022</span></span><span class=level-end><span class="level-item tag">1</span></span></a><li><a class="level is-mobile" href=/archives/2022/05/ ><span class=level-start><span class=level-item>五月 2022</span></span><span class=level-end><span class="level-item tag">1</span></span></a></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" id=toc data-type=toc><div class=card-content><div class=menu><h3 class=menu-label>目录</h3><ul class=menu-list><li><a class="level is-mobile" href=#partuuid-%E4%B8%8E-uuid><span class=level-left><span class=level-item>1</span><span class=level-item>PARTUUID 与 UUID</span></span></a><li><a class="level is-mobile" href=#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-a%EF%BC%9A%E8%AE%A9-grub-%E4%BD%BF%E7%94%A8-partuuid-%E6%88%96%E8%B7%AF%E5%BE%84><span class=level-left><span class=level-item>2</span><span class=level-item>解决方案 A：让 grub 使用 PARTUUID 或路径</span></span></a><li><a class="level is-mobile" href=#%E5%88%86%E6%9E%90-initramfs-%E5%8A%A0%E8%BD%BD><span class=level-left><span class=level-item>3</span><span class=level-item>分析 initramfs 加载</span></span></a><li><a class="level is-mobile" href=#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-b%EF%BC%9A%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8-gzip-%E5%8E%8B%E7%BC%A9-initramfs><span class=level-left><span class=level-item>4</span><span class=level-item>解决方案 B：配置使用 gzip 压缩 initramfs</span></span></a></ul></div></div><style>#toc .menu-list>li>a.is-active+.menu-list{display:block}#toc .menu-list>li>a+.menu-list{display:none}</style><script src=/js/toc.js defer></script></div><div class="card widget" data-type=recent-posts><div class=card-content><h3 class=menu-label>最新文章</h3><article class=media><figure class=media-left><a class=image href=/2024/09/29/bonjour_fix/ ><img src=https://cdn.pixabay.com/photo/2023/08/08/21/25/france-8178164_1280.jpg alt="Bonjour 不 Bon：修复 Bonjour 中存在的 IPv6 栈溢出 bug"></a></figure><div class=media-content><p class=date><time datetime=2024-09-29T23:15:16.000Z>2024-09-30</time><p class=title><a href=/2024/09/29/bonjour_fix/ >Bonjour 不 Bon：修复 Bonjour 中存在的 IPv6 栈溢出 bug</a><p class=categories><a href=/categories/%E9%80%86%E5%90%91/ >逆向</a></div></article><article class=media><figure class=media-left><a class=image href=/2024/05/18/initramfs_boot_fail/ ><img src=https://cdn.pixabay.com/photo/2023/12/29/15/37/balloons-8476432_1280.jpg alt="一次 Linux 5.4 内核启动失败分析"></a></figure><div class=media-content><p class=date><time datetime=2024-05-18T15:25:38.000Z>2024-05-18</time><p class=title><a href=/2024/05/18/initramfs_boot_fail/ >一次 Linux 5.4 内核启动失败分析</a><p class=categories><a href=/categories/%E5%86%85%E6%A0%B8/ >内核</a></div></article><article class=media><figure class=media-left><a class=image href=/2023/05/19/clangd_vsc_fault/ ><img src=https://cdn.pixabay.com/photo/2023/05/15/15/33/landscape-7995369_1280.jpg alt="Apple Clangd 掉坑记"></a></figure><div class=media-content><p class=date><time datetime=2023-05-19T07:51:21.000Z>2023-05-19</time><p class=title><a href=/2023/05/19/clangd_vsc_fault/ >Apple Clangd 掉坑记</a><p class=categories><a href=/categories/%E6%9D%82%E8%B0%88/ >杂谈</a></div></article><article class=media><figure class=media-left><a class=image href=/2023/04/21/skbuff_repost/ ><img src=https://cdn.pixabay.com/photo/2018/10/19/12/14/train-3758523_1280.jpg alt="Linux 内核网络中的 sk_buff 数据结构"></a></figure><div class=media-content><p class=date><time datetime=2023-04-21T02:22:53.000Z>2023-04-21</time><p class=title><a href=/2023/04/21/skbuff_repost/ >Linux 内核网络中的 sk_buff 数据结构</a><p class=categories><a href=/categories/%E5%86%85%E6%A0%B8/ >内核</a></div></article><article class=media><figure class=media-left><a class=image href=/2023/04/20/cfs_weight_nice/ ><img src=https://cdn.pixabay.com/photo/2016/08/26/12/44/houses-1622066_1280.jpg alt=CFS调度器、权重、优先级与虚拟时钟></a></figure><div class=media-content><p class=date><time datetime=2023-04-20T13:47:32.000Z>2023-04-20</time><p class=title><a href=/2023/04/20/cfs_weight_nice/ >CFS调度器、权重、优先级与虚拟时钟</a><p class=categories><a href=/categories/%E5%86%85%E6%A0%B8/ >内核</a></div></article></div></div><div class="card widget" data-type=subscribe-email><div class=card-content><div class=menu><h3 class=menu-label>follow.it</h3><form action="https://api.follow.it/subscription-form/a1BGa2tQbURTbStQandqbGNOeWgzcytQME9iVityYVNVaVVGR2N5NzlGZDFaWDlHYnRLc0hmczZrVDFOY3dzamVYTDFIdGZxOVgvNTJwRm5RNjlqVVN5RzBNK0M1RVBUOEhlZXUwOEtyWG8vRVhPRUR4RFZFeUdwbTArSE0vdmF8dkswd0lGYUxxRGM0RHpnd280RDBtT3JXenNZQ2N6RG5oeVNjMjVTNitlcz0=/8" method=post target=_blank><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class=input name=email type=email placeholder=Email><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class=control><input class=button type=submit value=订阅></div></div></form></div></div></div><div class="card widget" data-type=links><div class=card-content><div class=menu><h3 class=menu-label>链接</h3><ul class=menu-list><li><a class="level is-mobile" href=https://MoeClue.com/ target=_blank rel=noopener><span class=level-left><span class=level-item>Moeka</span></span><span class=level-right><span class="level-item tag">moeclue.com</span></span></a><li><a class="level is-mobile" href=https://mou.best target=_blank rel=noopener><span class=level-left><span class=level-item>小莫のBase</span></span><span class=level-right><span class="level-item tag">mou.best</span></span></a></ul></div></div></div></div></div></div></section><footer class=footer><div class=container><div class=level><div class=level-start><a class="footer-logo is-block mb-2" href=/ ><img src=/img/logo.png alt=浮枕星海 height=28></a><p class=is-size-7><span>&copy; 2024 浮枕</span>  Powered by <a href=https://hexo.io/ target=_blank rel=noopener>Hexo</a> &amp; <a href=https://github.com/ppoffice/hexo-theme-icarus target=_blank rel=noopener>Icarus</a><br><span id=busuanzi_container_site_uv>共<span id=busuanzi_value_site_uv>0</span>个访客</span><p class=is-size-7>世界は、あなたのスキで目覚め、変わってゆくものなのですから...</div><div class=level-end><div class="field has-addons"><p class=control><a class="button is-transparent" target=_blank rel=noopener title="CC BY-NC-SA 4.0" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ >CC BY-NC-SA 4.0</a><p class=control><a class="button is-transparent is-large" target=_blank rel=noopener title="CC BY-NC-SA 4.0 icons" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ ><i class="fab fa-creative-commons"></i> <i class="fab fa-creative-commons-by"></i> <i class="fab fa-creative-commons-nc"></i> <i class="fab fa-creative-commons-sa"></i> </a></div></div></div></div></footer><script src=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-d/jquery/3.3.1/jquery.min.js></script><script src=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-d/moment.js/2.22.2/moment-with-locales.min.js></script><script src=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-d/clipboard.js/2.0.4/clipboard.min.js defer></script><script>moment.locale("zh-cn")</script><script>var IcarusThemeSettings={article:{highlight:{clipboard:!0,fold:"unfolded"}}}</script><script src=/js/column.js></script><script src=/js/animation.js></script><a id=back-to-top title=回到顶端 href=javascript:;><i class="fas fa-chevron-up"></i></a><script src=/js/back_to_top.js defer></script><!--!--><!--!--><!--!--><!--!--><script src=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-d/cookieconsent/3.1.1/cookieconsent.min.js defer></script><script>window.addEventListener("load",(()=>{window.cookieconsent.initialise({type:"info",theme:"edgeless",static:!1,position:"bottom-right",content:{message:"此网站使用Cookie来改善您的体验。",dismiss:"知道了！",allow:"允许使用Cookie",deny:"拒绝",link:"了解更多",policy:"Cookie政策",href:"https://www.cookiesandyou.com/"},palette:{popup:{background:"#edeff5",text:"#838391"},button:{background:"#4b81e8"}}})}))</script><script src=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-d/lightgallery/1.10.0/js/lightgallery.min.js defer></script><script src=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-d/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js defer></script><script>window.addEventListener("load",(()=>{"function"==typeof $.fn.lightGallery&&$(".article").lightGallery({selector:".gallery-item"}),"function"==typeof $.fn.justifiedGallery&&($(".justified-gallery > p > .gallery-item").length&&$(".justified-gallery > p > .gallery-item").unwrap(),$(".justified-gallery").justifiedGallery())}))</script><!--!--><!--!--><script id=MathJax-script async>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"},chtml:{matchFontHeight:!1}}</script><script src=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-d/mathjax/3.2.2/es5/tex-mml-chtml.js></script><div id=outdated><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id=btnUpdateBrowser target=_blank rel=noopener href=http://outdatedbrowser.com/ >Update my browser now</a><p class=last><a href=# id=btnCloseUpdateBrowser title=Close>×</a></div><script src=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-d/outdated-browser/1.1.5/outdatedbrowser.min.js defer></script><script>window.addEventListener("load",(function(){outdatedBrowser({bgColor:"#f25648",color:"#ffffff",lowerThan:"object-fit"})}))</script><!--!--><!--!--><!--!--><script src=/js/main.js defer></script><div class=searchbox><div class=searchbox-container><div class=searchbox-header><div class=searchbox-input-container><input class=searchbox-input placeholder=想要查找什么...></div><a class=searchbox-close href=javascript:;>×</a></div><div class=searchbox-body></div></div></div><script src=/js/insight.js defer></script><script>document.addEventListener("DOMContentLoaded",(function(){loadInsight({contentUrl:"/content.json"},{hint:"想要查找什么...",untitled:"(无标题)",posts:"文章",pages:"页面",categories:"分类",tags:"标签"})}))</script>
